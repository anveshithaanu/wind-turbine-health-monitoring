<div class="app-container">
  <!-- Unique Floating Header -->
  <div class="floating-header">
    <div class="header-content-wrapper">
      <div class="logo-section">
        <div class="logo-circle">
          <svg class="wind-turbine-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <rect x="45" y="30" width="10" height="60" fill="currentColor" opacity="0.8"/>
            <ellipse cx="50" cy="90" rx="15" ry="8" fill="currentColor" opacity="0.6"/>
            <line x1="50" y1="30" x2="30" y2="15" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
            <line x1="50" y1="30" x2="70" y2="15" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
            <line x1="50" y1="30" x2="50" y2="5" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
            <circle cx="50" cy="30" r="4" fill="currentColor"/>
          </svg>
        </div>
        <div class="title-section">
          <h1>Wind Turbine Health Monitor</h1>
          <p>Monitor and manage your wind turbine operations efficiently</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Unique Navigation Pills -->
  <div class="nav-pills-container">
    <div class="nav-pills">
      <button 
        class="nav-pill" 
        [class.active]="currentPage === 'dashboard'" 
        (click)="navigateToPage('dashboard')">
        <span class="pill-icon">üìä</span>
        <span class="pill-text">Dashboard</span>
      </button>
      <button 
        class="nav-pill" 
        [class.active]="currentPage === 'turbines'" 
        (click)="navigateToPage('turbines')">
        <span class="pill-icon">‚öôÔ∏è</span>
        <span class="pill-text">Turbines</span>
      </button>
      <button 
        class="nav-pill" 
        [class.active]="currentPage === 'analytics'" 
        (click)="navigateToPage('analytics')">
        <span class="pill-icon">üìà</span>
        <span class="pill-text">Analytics</span>
      </button>
      <button 
        class="nav-pill" 
        [class.active]="currentPage === 'alerts'" 
        (click)="navigateToPage('alerts')">
        <span class="pill-icon">üîî</span>
        <span class="pill-text">Alerts</span>
      </button>
    </div>
  </div>

  <div class="main-content" [style.display]="'block'">

    <div *ngIf="currentPage === 'dashboard'" class="dashboard">
      <div class="section">
        <h3>Where to look?</h3>
        <p>Choose region and farm to narrow results</p>
        <div class="filters">
          <div class="filter-group">
            <label>Region</label>
            <select class="filter-select" [(ngModel)]="dashboardFilters.region" (change)="applyFilters()">
              <option value="">All regions</option>
              <option *ngFor="let region of getRegions()" [value]="region">{{ region }}</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Farm</label>
            <select class="filter-select" [(ngModel)]="dashboardFilters.farm" (change)="applyFilters()">
              <option value="">All farms</option>
              <option *ngFor="let farm of farms" [value]="farm.name">{{ farm.name }}</option>
            </select>
          </div>
        </div>
      </div>

      <div class="section">
        <h3>At a glance</h3>
        <div class="stats-grid">
          <div class="stat-card-modern healthy">
            <div class="stat-card-inner">
              <div class="stat-icon-wrapper healthy">
                <span class="stat-icon">‚úì</span>
              </div>
              <div class="stat-content">
                <div class="stat-value">{{ getHealthyCount() }}</div>
                <div class="stat-label">Healthy</div>
              </div>
              <div class="stat-accent-line healthy"></div>
            </div>
          </div>
          <div class="stat-card-modern warning">
            <div class="stat-card-inner">
              <div class="stat-icon-wrapper warning">
                <span class="stat-icon">‚ö†</span>
              </div>
              <div class="stat-content">
                <div class="stat-value">{{ getWarningCount() }}</div>
                <div class="stat-label">Warning</div>
              </div>
              <div class="stat-accent-line warning"></div>
            </div>
          </div>
          <div class="stat-card-modern critical">
            <div class="stat-card-inner">
              <div class="stat-icon-wrapper critical">
                <span class="stat-icon">!</span>
              </div>
              <div class="stat-content">
                <div class="stat-value">{{ getCriticalCount() }}</div>
                <div class="stat-label">Critical</div>
              </div>
              <div class="stat-accent-line critical"></div>
            </div>
          </div>
          <div class="stat-card-modern offline">
            <div class="stat-card-inner">
              <div class="stat-icon-wrapper offline">
                <span class="stat-icon">‚óã</span>
              </div>
              <div class="stat-content">
                <div class="stat-value">{{ getOfflineCount() }}</div>
                <div class="stat-label">Offline</div>
              </div>
              <div class="stat-accent-line offline"></div>
            </div>
          </div>
          <div class="stat-card-modern total">
            <div class="stat-card-inner">
              <div class="stat-icon-wrapper total">
                <span class="stat-icon">‚ö°</span>
              </div>
              <div class="stat-content">
                <div class="stat-value">{{ stats.totalTurbines }}</div>
                <div class="stat-label">Total Turbines</div>
              </div>
              <div class="stat-accent-line total"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="section">
        <h3>Health status distribution</h3>
        <p>Share of turbines by status</p>
        <div class="chart-placeholder">
          <div class="donut-chart-wrapper">
            <svg viewBox="0 0 200 200" class="donut-chart">
              <path *ngIf="getDonutChartPath('healthy') !== ''" [attr.d]="getDonutChartPath('healthy')" [attr.fill]="getDonutChartColor('healthy')" />
              <path *ngIf="getDonutChartPath('warning') !== ''" [attr.d]="getDonutChartPath('warning')" [attr.fill]="getDonutChartColor('warning')" />
              <path *ngIf="getDonutChartPath('critical') !== ''" [attr.d]="getDonutChartPath('critical')" [attr.fill]="getDonutChartColor('critical')" />
              <path *ngIf="getDonutChartPath('offline') !== ''" [attr.d]="getDonutChartPath('offline')" [attr.fill]="getDonutChartColor('offline')" />
              <!-- Show empty state ring when no turbines -->
              <path *ngIf="turbines.length === 0" [attr.d]="getDonutChartPath('offline')" fill="#e2e8f0" opacity="0.5" />
              <text x="100" y="95" text-anchor="middle" class="donut-center-text-large">{{ getHealthyCount() + getWarningCount() + getCriticalCount() + getOfflineCount() }}</text>
              <text x="100" y="115" text-anchor="middle" class="donut-center-text-small">Total</text>
            </svg>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="currentPage === 'turbines'" class="turbines-page">
      <div class="section">
        <h3>Turbine assets</h3>
        <p>Filter by region and farm to find turbines</p>
        <div class="filters">
          <div class="filter-group">
            <label>Region</label>
            <select class="filter-select" [(ngModel)]="turbinesFilters.region" (change)="applyFilters()">
              <option value="">All regions</option>
              <option *ngFor="let region of getRegions()" [value]="region">{{ region }}</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Farm</label>
            <select class="filter-select" [(ngModel)]="turbinesFilters.farm" (change)="applyFilters()">
              <option value="">All farms</option>
              <option *ngFor="let farm of farms" [value]="farm.name">{{ farm.name }}</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Status</label>
            <select class="filter-select" [(ngModel)]="turbinesFilters.status" (change)="applyFilters()">
              <option value="">All status</option>
              <option value="ACTIVE">Active</option>
              <option value="INACTIVE">Inactive</option>
              <option value="MAINTENANCE">Maintenance</option>
              <option value="OFFLINE">Offline</option>
            </select>
          </div>
        </div>
      </div>

      <div class="section">
        <h3>Asset list</h3>
        <p>Turbine metadata for reporting and planning</p>
        <div class="table-container">
          <table class="turbines-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>NAME</th>
                <th>FARM</th>
                <th>REGION</th>
                <th>STATUS</th>
                <th>CAPACITY (MW)</th>
                <th>INSTALLED</th>
                <th>LAST UPDATED</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let turbine of getPaginatedTurbines()">
                <td>{{ turbine.turbineId }}</td>
                <td>{{ turbine.name }}</td>
                <td>{{ turbine.farm?.name || 'N/A' }}</td>
                <td>{{ turbine.farm?.region || 'N/A' }}</td>
                <td>
                  <span class="status-badge" [ngClass]="getStatusClass(turbine.status)">
                    {{ turbine.status }}
                  </span>
                </td>
                <td>{{ turbine.ratedPower }}</td>
                <td>{{ formatDate(turbine.installedDate) }}</td>
                <td>{{ formatDate(turbine.lastUpdated) }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="pagination-container" *ngIf="pagination.totalPages > 0">
          <div class="pagination-info">
            <span>Showing {{ (pagination.currentPage * pagination.itemsPerPage) + 1 }} to {{ Math.min((pagination.currentPage + 1) * pagination.itemsPerPage, pagination.totalItems) }} of {{ pagination.totalItems }} turbines</span>
            <select class="pagination-select" [ngModel]="pagination.itemsPerPage" (ngModelChange)="changeItemsPerPage($event)">
              <option value="5">5 per page</option>
              <option value="10">10 per page</option>
              <option value="25">25 per page</option>
              <option value="50">50 per page</option>
              <option value="100">100 per page</option>
            </select>
          </div>
          <div class="pagination-controls">
            <button class="pagination-btn" [disabled]="pagination.currentPage === 0" (click)="goToPage(0)">First</button>
            <button class="pagination-btn" [disabled]="pagination.currentPage === 0" (click)="goToPage(pagination.currentPage - 1)">Previous</button>
            <span class="pagination-page-info">Page {{ pagination.currentPage + 1 }} of {{ pagination.totalPages }}</span>
            <button class="pagination-btn" [disabled]="pagination.currentPage >= pagination.totalPages - 1" (click)="goToPage(pagination.currentPage + 1)">Next</button>
            <button class="pagination-btn" [disabled]="pagination.currentPage >= pagination.totalPages - 1" (click)="goToPage(pagination.totalPages - 1)">Last</button>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="currentPage === 'alerts'" class="alerts-page">
      <div class="section">
        <h3>Health Alerts</h3>
        <div class="table-container" *ngIf="alerts.length > 0">
          <table class="alerts-table">
            <thead>
              <tr>
                <th>Turbine ID</th>
                <th>Alert Type</th>
                <th>Severity</th>
                <th>Message</th>
                <th>Time</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let alert of getPaginatedAlerts()">
                <td>{{ alert.turbine?.turbineId }}</td>
                <td>{{ alert.alertType }}</td>
                <td>
                  <span class="status-badge" [ngClass]="'status-' + alert.severity.toLowerCase()">
                    {{ alert.severity }}
                  </span>
                </td>
                <td>{{ alert.message }}</td>
                <td>{{ formatDate(alert.alertTime) }}</td>
                <td>
                  <button class="btn-small" (click)="resolveAlert(alert.id!)">Resolve</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="pagination-container" *ngIf="alertPagination.totalPages > 0 && alerts.length > 0">
          <div class="pagination-info">
            <span>Showing {{ (alertPagination.currentPage * alertPagination.itemsPerPage) + 1 }} to {{ Math.min((alertPagination.currentPage + 1) * alertPagination.itemsPerPage, alertPagination.totalItems) }} of {{ alertPagination.totalItems }} alerts</span>
            <select class="pagination-select" [ngModel]="alertPagination.itemsPerPage" (ngModelChange)="changeAlertItemsPerPage($event)">
              <option value="5">5 per page</option>
              <option value="10">10 per page</option>
              <option value="25">25 per page</option>
              <option value="50">50 per page</option>
            </select>
          </div>
          <div class="pagination-controls">
            <button class="pagination-btn" [disabled]="alertPagination.currentPage === 0" (click)="goToAlertPage(0)">First</button>
            <button class="pagination-btn" [disabled]="alertPagination.currentPage === 0" (click)="goToAlertPage(alertPagination.currentPage - 1)">Previous</button>
            <span class="pagination-page-info">Page {{ alertPagination.currentPage + 1 }} of {{ alertPagination.totalPages }}</span>
            <button class="pagination-btn" [disabled]="alertPagination.currentPage >= alertPagination.totalPages - 1" (click)="goToAlertPage(alertPagination.currentPage + 1)">Next</button>
            <button class="pagination-btn" [disabled]="alertPagination.currentPage >= alertPagination.totalPages - 1" (click)="goToAlertPage(alertPagination.totalPages - 1)">Last</button>
          </div>
        </div>
        
        <div *ngIf="alerts.length === 0" class="empty-state">
          <p>No active alerts</p>
        </div>
      </div>
    </div>

    <div *ngIf="currentPage === 'analytics'" class="analytics-page">
      <div class="section">
        <h3>Historical performance</h3>
        <p>Daily generation and efficiency to plan maintenance</p>
        <div class="filters">
          <div class="filter-group">
            <label>Farm</label>
            <select class="filter-select" [(ngModel)]="analyticsFilters.farm" (change)="loadAnalytics()">
              <option value="">All farms</option>
              <option *ngFor="let farm of farms" [value]="farm.name">{{ farm.name }}</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Period (Days)</label>
            <input type="number" class="filter-select" 
                   [(ngModel)]="analyticsFilters.period" 
                   (change)="loadAnalytics()" 
                   min="1" 
                   max="365" 
                   required
                   placeholder="Days (1-365)">
            <small class="validation-message" *ngIf="isInvalidPeriod()">
              Period must be between 1 and 365 days
            </small>
          </div>
        </div>
      </div>

      <div class="section">
        <h3>Daily generation & efficiency</h3>
        <p>Trends over time</p>
        <div class="analytics-chart">
          <div class="chart-container-modern">
            <svg viewBox="0 0 1000 370" class="line-chart-svg">
              <!-- Grid lines -->
              <g class="grid-lines">
                <line x1="50" y1="25" x2="950" y2="25" stroke="#e2e8f0" stroke-width="1" opacity="0.5"/>
                <line x1="50" y1="105" x2="950" y2="105" stroke="#e2e8f0" stroke-width="1" opacity="0.5"/>
                <line x1="50" y1="185" x2="950" y2="185" stroke="#e2e8f0" stroke-width="1" opacity="0.5"/>
                <line x1="50" y1="265" x2="950" y2="265" stroke="#e2e8f0" stroke-width="1" opacity="0.5"/>
                <line x1="50" y1="345" x2="950" y2="345" stroke="#e2e8f0" stroke-width="1" opacity="0.5"/>
              </g>
              
              <!-- Y-axis labels (Generation) -->
              <g class="y-axis-labels generation-labels">
                <text x="45" y="30" text-anchor="end" class="axis-label">{{ getGenerationYLabel(0) }}</text>
                <text x="45" y="110" text-anchor="end" class="axis-label">{{ getGenerationYLabel(1) }}</text>
                <text x="45" y="190" text-anchor="end" class="axis-label">{{ getGenerationYLabel(2) }}</text>
                <text x="45" y="270" text-anchor="end" class="axis-label">{{ getGenerationYLabel(3) }}</text>
                <text x="45" y="350" text-anchor="end" class="axis-label">{{ getGenerationYLabel(4) }}</text>
              </g>
              
              <!-- Y-axis labels (Efficiency) -->
              <g class="y-axis-labels efficiency-labels">
                <text x="955" y="30" text-anchor="start" class="axis-label efficiency">{{ getEfficiencyYLabel(0) }}</text>
                <text x="955" y="110" text-anchor="start" class="axis-label efficiency">{{ getEfficiencyYLabel(1) }}</text>
                <text x="955" y="190" text-anchor="start" class="axis-label efficiency">{{ getEfficiencyYLabel(2) }}</text>
                <text x="955" y="270" text-anchor="start" class="axis-label efficiency">{{ getEfficiencyYLabel(3) }}</text>
                <text x="955" y="350" text-anchor="start" class="axis-label efficiency">{{ getEfficiencyYLabel(4) }}</text>
              </g>
              
              <!-- Generation area and line -->
              <g class="generation-chart">
                <path *ngIf="graphData.length > 0" [attr.d]="getGenerationAreaPath()" fill="rgba(16, 185, 129, 0.1)" class="area-path"/>
                <path *ngIf="graphData.length > 0" [attr.d]="getGenerationPath()" stroke="#10b981" stroke-width="3" fill="none" class="line-path"/>
                <g class="generation-points">
                  <ng-container *ngFor="let data of graphData; let i = index">
                    <circle *ngIf="data.generation > 0"
                            [attr.cx]="getChartX(i)" 
                            [attr.cy]="getGenerationY(data.generation)" 
                            r="4" 
                            fill="#10b981" 
                            stroke="#ffffff" 
                            stroke-width="2"/>
                  </ng-container>
                </g>
              </g>
              
              <!-- Efficiency area and line -->
              <g class="efficiency-chart">
                <path *ngIf="graphData.length > 0" [attr.d]="getEfficiencyAreaPath()" fill="rgba(14, 165, 233, 0.1)" class="area-path"/>
                <path *ngIf="graphData.length > 0" [attr.d]="getEfficiencyPath()" stroke="#0ea5e9" stroke-width="3" fill="none" class="line-path"/>
                <g class="efficiency-points">
                  <ng-container *ngFor="let data of graphData; let i = index">
                    <circle *ngIf="data.efficiency > 0"
                            [attr.cx]="getChartX(i)" 
                            [attr.cy]="getEfficiencyY(data.efficiency)" 
                            r="4" 
                            fill="#0ea5e9" 
                            stroke="#ffffff" 
                            stroke-width="2"/>
                  </ng-container>
                </g>
              </g>
              
              <!-- X-axis labels -->
              <g class="x-axis-labels">
                <text *ngFor="let data of graphData; let i = index" 
                      [attr.x]="getChartX(i)" 
                      y="365" 
                      text-anchor="middle" 
                      class="axis-label x-axis"
                      [attr.transform]="'rotate(-45 ' + getChartX(i) + ' 365)'">
                  {{ data.displayDate || data.date }}
                </text>
              </g>
              
              <!-- Legend -->
              <g class="chart-legend">
                <g class="legend-item">
                  <line x1="60" y1="20" x2="80" y2="20" stroke="#10b981" stroke-width="3"/>
                  <text x="85" y="25" class="legend-text">Total Generation (kWh)</text>
                </g>
                <g class="legend-item">
                  <line x1="60" y1="40" x2="80" y2="40" stroke="#0ea5e9" stroke-width="3"/>
                  <text x="85" y="45" class="legend-text">Avg Efficiency (%)</text>
                </g>
              </g>
            </svg>
          </div>
        </div>
      </div>

      <div class="section">
        <h3>Daily metrics</h3>
        <p>Per-farm totals and averages</p>
        <div class="table-container" *ngIf="analyticsData.length > 0">
          <table class="analytics-table">
            <thead>
              <tr>
                <th>DATE</th>
                <th>FARM</th>
                <th>TOTAL GENERATION (KWH)</th>
                <th>AVG EFFICIENCY %</th>
                <th>OPERATING HOURS</th>
                <th>MAX POWER (KW)</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of analyticsData">
                <td>{{ data.date }}</td>
                <td>{{ data.farm }}</td>
                <td>{{ data.generation.toFixed(2) }}</td>
                <td>{{ data.efficiency.toFixed(1) }}%</td>
                <td>{{ data.hours.toFixed(1) }}</td>
                <td>{{ data.maxPower.toFixed(2) }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="no-data-message" *ngIf="analyticsData.length === 0">
          <p>No data available for the selected period.</p>
          <p class="no-data-hint">Data will appear after telemetry aggregation runs. Aggregation occurs hourly for the previous hour.</p>
        </div>
      </div>

      <div class="section">
        <h3>Summary Report</h3>
        <div class="report-grid">
          <div class="report-card">
            <div class="report-label">Total Turbines</div>
            <div class="report-value">{{ turbines.length }}</div>
          </div>
          <div class="report-card">
            <div class="report-label">Active Turbines</div>
            <div class="report-value">{{ getHealthyCount() }}</div>
          </div>
          <div class="report-card">
            <div class="report-label">Total Farms</div>
            <div class="report-value">{{ farms.length }}</div>
          </div>
          <div class="report-card">
            <div class="report-label">Active Alerts</div>
            <div class="report-value">{{ alerts.length }}</div>
          </div>
          <div class="report-card">
            <div class="report-label">Avg Efficiency</div>
            <div class="report-value">{{ getAvgEfficiency().toFixed(1) }}%</div>
          </div>
          <div class="report-card">
            <div class="report-label">Total Capacity</div>
            <div class="report-value">{{ getTotalCapacity().toFixed(2) }} MW</div>
          </div>
        </div>
      </div>
    </div>

    <div class="loading" *ngIf="loading && currentPage === 'dashboard'">
      <p>Loading...</p>
    </div>

    <div class="error" *ngIf="error && !loading && currentPage === 'dashboard'">
      <p>{{ error }}</p>
      <button class="btn-small" (click)="loadData()" style="margin-top: 10px;">Retry</button>
    </div>
  </div>
</div>
